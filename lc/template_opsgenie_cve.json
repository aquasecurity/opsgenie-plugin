{

{{if (.event.Resolve "$.imagehash")}}
  "message": "Image scan results",
  "description":"Image scan for image {{.event.Resolve "$.imagename"}} reveled vulnerabilities",

{{else}}
  "message": "Host scan for host {{.event.Resolve "$.hostname"}} reveled vulnerabilities",
{{end}}


{{if (.event.Resolve "$.containername")}}
  "alias": "{{.event.Resolve "$.containername"}}",
{{else}}
  "alias": "{{.event.Resolve "$.imagename"}}",
{{end}}

 
{{if .responders}}
  "responders":[
    {{.responders}}
  ],
{{end}}

{{if .visibleTo}}
  "visibleTo":[
    {{.visibleTo}}
  ],
{{end}}

{{if .user}}
  "user": "{{.user}}",
{{end}}

{{if .entity}}
  "entity": "{{.entity}}",
{{end}}

{{if .source}}
  "source": "{{.source}}",
{{end}}

{{if .event.Resolve "$.data"}}
{{$keys := (keysSlice (.event.Resolve "$.data"))}}
{{$lastIndex := (sub (len $keys) 1)}}
{{$eventVar := .event}}
  "details":{
{{range $index, $key := $keys}}
{{$path := (printf "$.data.%s" $key)}}
    "{{$key}}": "{{js ($eventVar.ResolveAsString $path)}}"{{if ne $lastIndex $index}},{{end}}
{{end}}
  },
{{end}}

{{if eq (.event.Resolve "$.result") 4}}
  "priority":"P2"
{{else}}
  "priority":"P3"
{{end}}
}
